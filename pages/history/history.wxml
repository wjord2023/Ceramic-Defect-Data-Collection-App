<view class="container">
  <!-- 筛选区域 -->
  <view class="filter-section">
    <view class="filter-row">
      <view class="filter-item">
        <text class="filter-label">缺陷类型：</text>
        <picker range="{{filterOptions}}" 
                range-key="label" 
                value="{{filterIndex}}" 
                bindchange="onFilterChange">
          <view class="picker-btn">
            <text>{{filterOptions[filterIndex].label}}</text>
            <image class="arrow-icon" src="/images/arrow-down.png"></image>
          </view>
        </picker>
      </view>
      
      <view class="filter-item">
        <text class="filter-label">排序方式：</text>
        <picker range="{{sortOptions}}" 
                range-key="label" 
                value="{{sortIndex}}" 
                bindchange="onSortChange">
          <view class="picker-btn">
            <text>{{sortOptions[sortIndex].label}}</text>
            <image class="arrow-icon" src="/images/arrow-down.png"></image>
          </view>
        </picker>
      </view>
    </view>
  </view>

  <!-- 统计信息 -->
  <view class="stats-bar">
    <text class="stats-text">共 {{filteredRecords.length}} 条记录</text>
  </view>

  <!-- 记录列表 -->
  <view class="records-list" wx:if="{{filteredRecords.length > 0}}">
    <view class="record-item" 
          wx:for="{{filteredRecords}}" 
          wx:key="id" 
          bindtap="viewRecord" 
          data-record="{{item}}">
      <view class="record-image">
        <image src="{{item.imagePath}}" mode="aspectFill" class="thumbnail"></image>
        <view class="severity-tag" style="background: {{item.severityColor}}">
          {{item.severity || '未分类'}}
        </view>
      </view>
      
      <view class="record-info">
        <view class="record-header">
          <text class="record-time">{{item.formatTime}}</text>
          <image class="action-icon delete" 
                 src="/images/delete.png" 
                 bindtap="deleteRecord" 
                 data-id="{{item.id}}"
                 catchtap="">
          </image>
        </view>
        
        <view class="defect-types" wx:if="{{item.defectTypeDisplay && item.defectTypeDisplay !== ''}}">
          <text class="defect-label">缺陷：</text>
          <text class="defect-text">{{item.defectTypeDisplay}}</text>
        </view>
        
        <view class="record-meta">
          <text class="meta-item" wx:if="{{item.collector}}">
            <image class="meta-icon" src="/images/user.png"></image>
            {{item.collector}}
          </text>
          <text class="meta-item">
            <image class="meta-icon" src="/images/id.png"></image>
            ID: {{item.id}}
          </text>
        </view>
      </view>
    </view>
  </view>

  <!-- 空状态 -->
  <view class="empty-state" wx:else>
    <image class="empty-icon" src="/images/empty.png"></image>
    <text class="empty-text">暂无记录</text>
    <text class="empty-desc">开始采集陶瓷缺陷数据吧</text>
    <button class="start-collect-btn" bindtap="goToCollect">开始采集</button>
  </view>
</view>

<!-- 详情模态框 -->
<view class="detail-modal {{showDetail ? 'show' : ''}}" bindtap="hideDetail">
  <view class="modal-content" catchtap="" wx:if="{{selectedRecord}}">
    <view class="modal-header">
      <text class="modal-title">记录详情</text>
      <image class="close-btn" src="/images/close.png" bindtap="hideDetail"></image>
    </view>
    
    <view class="detail-image">
      <image src="{{selectedRecord.imagePath}}" mode="aspectFit" class="full-image"></image>
    </view>
    
    <view class="detail-info">
      <view class="info-row">
        <text class="info-label">严重程度:</text>
        <text class="info-value" style="color: {{selectedRecord.severityColor}}; font-weight: bold;">
          {{selectedRecord.severity || '未分类'}}
        </text>
      </view>
      
      <view class="info-row" wx:if="{{selectedRecord.defectTypeDisplay && selectedRecord.defectTypeDisplay !== ''}}">
        <text class="info-label">缺陷类型:</text>
        <text class="info-value">{{selectedRecord.defectTypeDisplay}}</text>
      </view>
      
      <view class="info-row">
        <text class="info-label">采集时间:</text>
        <text class="info-value">{{selectedRecord.formatTime}}</text>
      </view>
      
      <view class="info-row" wx:if="{{selectedRecord.collector}}">
        <text class="info-label">采集人员:</text>
        <text class="info-value">{{selectedRecord.collector}}</text>
      </view>
    </view>
    
    <view class="modal-actions">
      <button class="modal-btn danger" bindtap="deleteRecord" data-id="{{selectedRecord.id}}">
        删除记录
      </button>
    </view>
  </view>
</view>