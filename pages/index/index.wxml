<!--index.wxml-->
<view class="container">
  <view class="header">
    <image class="logo" src="/images/ceramic-logo.png" mode="aspectFit"></image>
    <text class="title">陶瓷缺陷数据收集系统</text>
    <text class="subtitle">AI训练数据采集工具</text>
    <!-- 显示当前收集者 -->
    <view class="collector-info" bindtap="showNameSetting">
      <image class="collector-icon" src="/images/user.png"></image>
      <text class="collector-name">{{collectorName}}</text>
      <image class="edit-icon" src="/images/edit.png"></image>
    </view>
  </view>

  <view class="stats-section">
    <view class="stats-card">
      <text class="stats-number">{{totalCount}}</text>
      <text class="stats-label">总样本数</text>
    </view>
    <view class="stats-card">
      <text class="stats-number">{{todayCount}}</text>
      <text class="stats-label">今日采集</text>
    </view>
    <view class="stats-card">
      <text class="stats-number">{{cloudCount}}</text>
      <text class="stats-label">已上传</text>
    </view>
  </view>

  <view class="quick-actions">
    <button class="action-btn primary" bindtap="goToCollect">
      <image class="btn-icon" src="/images/camera-white.png"></image>
      开始采集
    </button>
    <button class="action-btn secondary" bindtap="goToHistory">
      <image class="btn-icon" src="/images/history-white.png"></image>
      查看记录
    </button>
  </view>

  <!-- 云端上传区域 -->
  <view class="cloud-section">
    <view class="cloud-header">
      <text class="section-title">云端数据管理</text>
    </view>

    <button class="upload-btn {{localCount > 0 ? 'active' : 'synced'}}" bindtap="uploadAllData" disabled="{{localCount === 0 || uploading}}">

      <!-- 主文字行：图标 + 主要文字 -->
      <view class="btn-main-row">
        <image class="btn-icon" src="/images/{{localCount > 0 ? 'cloud-upload' : 'check-circle'}}.png" wx:if="{{!uploading}}"></image>
        <view class="loading-spinner" wx:else></view>
        <text wx:if="{{localCount > 0}}">
          {{uploading ? '上传中...' : '一键上传全部数据'}}
        </text>
        <text wx:else>数据已同步</text>
      </view>

      <!-- 次要信息行：数量提示 -->
      <view class="btn-sub-row" wx:if="{{localCount > 0 && !uploading}}">
        （{{localCount}}条）
      </view>
    </button>
  </view>

  <view class="defect-types">
    <text class="section-title">缺陷类型统计</text>
    <view class="type-list">
      <view class="type-item" wx:for="{{defectTypes}}" wx:key="id">
        <view class="type-info">
          <text class="type-name">{{item.name}}</text>
          <text class="type-count">{{item.count}}张</text>
        </view>
        <view class="type-bar">
          <view class="type-progress" style="width: {{item.percentage}}%"></view>
        </view>
      </view>
    </view>
  </view>
</view>

<!-- 姓名设置弹窗 -->
<view class="name-modal {{showNameModal ? 'show' : ''}}" bindtap="hideNameModal">
  <view class="modal-content" catchtap="stopPropagation">
    <view class="modal-header">
      <text class="modal-title">设置收集者姓名</text>
      <image class="close-btn" src="/images/close.png" bindtap="hideNameModal"></image>
    </view>

    <view class="modal-body">
      <view class="input-group">
        <text class="input-label">姓名</text>
        <input class="name-input" placeholder="请输入您的姓名" value="{{tempName}}" bindinput="onNameInput" maxlength="10" cursor-spacing="20" confirm-type="done" />
      </view>
    </view>

    <view class="modal-actions">
      <button class="modal-btn cancel" bindtap="hideNameModal">取消</button>
      <button class="modal-btn confirm" bindtap="saveName">保存</button>
    </view>
  </view>
</view>